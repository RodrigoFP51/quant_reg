---
title: "Dashboard of College Costs"
output: 
  flexdashboard::flex_dashboard:
    theme:
      bg: "#cfe3db"
      fg: "#044f31" 
      primary: "#2be3be"
      base_font:
        google: Prompt
      code_font:
        google: JetBrains Mono
    orientation: columns
    vertical_layout: fill
    
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(quantreg)
library(tidyverse)
library(dlookr)
library(broom)
library(DataExplorer)
library(here)
library(ggridges)
library(shiny)

bslib::bs_themer()

custom_palette <- c("#192D45", "#748CDB", "#163B88", "#C1DFF9")

data <- read_csv(here("Dados/nces330_20.csv"), col_types = "iccccd") %>%
  rename(cost = "Value") %>%
  rename_with(.fn = str_to_lower)

summarize_data <- function(data){
  data %>%
    summarize(mean_cost = mean(cost),
              n         = n(),
              std_error = sd(cost) / sqrt(n()),
              .groups   = "drop")
}


```

Column {data-width=250 .sidebar}
-----------------------------------------------------------------------
```{r}
selectInput("cat_var", label = "Escolha a variÃ¡vel", 
            choices = c("type", "length", "expense"), 
            selected = "type")
```



Column {data-width=650 .tabset}
-----------------------------------------------------------------------

### Chart A

```{r}
renderPlot({
  data %>% 
  ggplot(aes(cost, .data[[input$cat_var]], fill = .data[[input$cat_var]])) +
  ggridges::geom_density_ridges(scale = 0.8,
                                alpha = 0.75, 
                                color = NA,
                                show.legend = FALSE) +
  geom_boxplot(width = 0.11, 
               color = "black",
               alpha = 0.5,
               outlier.color = NA,
               size = 0.8, 
               show.legend = FALSE) +
  scale_x_continuous(labels = scales::dollar, n.breaks = 6) +
  scale_fill_manual(values = custom_palette) +
  labs(x='',y='', fill='')
})


```

### Chart B

```{r}
renderPlot({
  data %>% 
  group_by(year, .data[[input$cat_var]]) %>% 
  summarize_data() %>% 
  ggplot(aes(year, mean_cost, color = .data[[input$cat_var]])) +
  geom_line(linewidth = 0.8) +
  geom_ribbon(aes(ymin = mean_cost - std_error,
                  ymax = mean_cost + std_error, 
                  fill = .data[[input$cat_var]]), 
              alpha = 0.1) +
  scale_x_continuous(breaks = 2013:2021) +
  scale_y_continuous(labels = scales::dollar) +
  scale_color_manual(values = custom_palette) +
  scale_fill_manual(values = custom_palette) +
  theme(legend.position = "bottom") +
  labs(x='', y='') 
})
```


